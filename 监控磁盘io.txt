
监控磁盘I/O

在很多服务器上，磁盘I/O往往会成为性能的瓶颈，监控磁盘的I/O成为了非常关键的工作。
监控I/O的命令iostat，iostat -dmx：
     -d是显示磁盘的使用状态，
     -m统计数据显示，以每秒兆字节，而不是块或千字节每秒。显示的数据只与内核2.4及更高版本有效。 
     -x显示扩展信息。
     
     Linux 2.6.32-358.el6.x86_64 (ck)    01/15/2016      _x86_64_        (48 CPU)
    Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s    wMB/s avgrq-sz avgqu-sz   await  svctm  %util
    sdc               0.24        36.95     1.35    2.18     0.13     0.15   163.59         0.01        3.48   0.43   0.15
    dm-0             5.18       832.51    412.64  122.02    16.36     5.10    82.22     0.04    0.08   0.12   6.58
    dm-1              0.00      0.00        417.82  954.54    16.36     5.10    32.03     0.03    0.08   0.05   6.59
    dm-2              0.00     0.00         417.82  948.78    16.36     5.10    32.17     0.03    0.00   0.05   6.60
    sda               0.00     0.00          58.53   12.62     2.26     0.62    82.92     0.03    0.41   0.63   4.51
    sdd               0.00     0.00          58.53   12.62     2.26     0.62    82.90     0.03    0.40   0.63   4.51
    sdb               0.00     0.00          58.54   12.61     2.26     0.62    82.95     0.02    0.21   0.60   4.28
    sde               0.00     0.00          58.53   12.62     2.26     0.62    82.91     0.02    0.24   0.61   4.32 

    rrqm/s     是每秒读请求的数量。
    wrqm/s    是每秒钟写请求的数量。
    r/s            每秒钟读请求完成的数量。
    w/s           每秒钟写请求完成的数量。
    rMB/s       每秒从设备读取的兆字节数。
    wMB/s      每秒从设备写入的兆字节数。
    avgrq-sz    平均请求扇区的大小。
    avgqu-sz   平均请求队列的长度。
    await         平均每次请求等待的时间。 
    svctm        平均每次请求的服务时间，本次完整IO从开始到结束响应的时间。
    %util          设备利用率。 
    
    关键是这几个参数： r/s,w/s,await,svctm,%util。
    await这列通常不超过10，svctm这列通常不超过5，util这列越低越好，最好低于50%。

    sar -d
    Linux 2.6.32-358.el6.x86_64 (ck)    01/15/2016      _x86_64_        (48 CPU)
12:00:01 AM       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
12:10:01 AM   dev8-32      4.17     51.66     41.07     22.25      0.00      1.13      0.72      0.30
12:10:01 AM  dev253-0    268.69 131485.97   1043.90    493.25      0.74      2.76      0.82     22.15
12:10:01 AM  dev253-1    389.75 131483.37   1043.90    340.03      2.05      5.24      0.57     22.17
12:10:01 AM  dev253-2    388.59 131484.24   1043.90    341.05      2.04      5.26      0.57     22.18
12:10:01 AM    dev8-0     67.46  32881.41    258.19    491.22      0.18      2.74      2.66     17.92
12:10:01 AM   dev8-48     67.46  32868.36    262.30    491.09      0.18      2.73      2.63     17.75
12:10:01 AM   dev8-16     67.46  32867.25    256.15    490.98      0.17      2.49      2.40     16.20
12:10:01 AM   dev8-64     67.46  32868.96    267.26    491.18      0.17      2.47      2.39     16.09
12:20:01 AM   dev8-32     68.08     11.61  30696.92    451.04      1.09     16.04      0.30      2.03
12:20:01 AM  dev253-0    270.34 136112.01   1075.79    507.47      0.62      2.31      0.73     19.61
12:20:01 AM  dev253-1    402.33 136112.88   1075.79    340.99      1.09      2.71      0.49     19.63
12:20:01 AM  dev253-2    401.26 136112.01   1075.79    341.89      1.09      2.72      0.49     19.64
12:20:01 AM    dev8-0     67.85  34023.85    268.54    505.41      0.15      2.25      2.22     15.07
12:20:01 AM   dev8-48     67.85  34041.28    273.41    505.73      0.15      2.23      2.20     14.96
12:20:01 AM   dev8-16     67.85  34023.80    281.65    505.61      0.14      2.13      2.10     14.28
12:20:01 AM   dev8-64     67.85  34023.08    252.18    505.17      0.14      2.13      2.10     14.26
12:30:01 AM   dev8-32      2.21      0.00     38.06     17.25      0.00      0.58      0.31      0.07
12:30:01 AM  dev253-0    129.14  83063.41    116.79    644.11      0.41      3.17      1.37     17.72
12:30:01 AM  dev253-1    178.60  83061.68    116.79    465.73      0.59      3.29      0.99     17.74
12:30:01 AM  dev253-2    177.58  83061.68    116.79    468.40      0.59      3.31      1.00     17.75
12:30:01 AM    dev8-0     32.54  20821.80     30.72    640.87      0.10      3.05      3.05      9.92
12:30:01 AM   dev8-48     32.54  20744.40     29.76    638.46      0.10      3.08      3.08     10.02
12:30:01 AM   dev8-16     32.54  20793.47     28.81    639.91      0.10      2.93      2.92      9.51
12:30:01 AM   dev8-64     32.54  20703.74     27.51    637.08      0.09      2.89      2.89      9.39
tps也就是iops，当然是越高越好，不过当iops从4000-5000，一下子到10000了，就要考虑是不是因为索引导致的，iops就是每秒读写多少个4KB。

rd_sec/s：每秒读取扇区的数量，每个扇区是512字节。



bi=block in to mem from disk从磁盘读取字节放到内存，一个block4KB ,I/O读


bo=block out from mem to disk 从内存读取写到磁盘的字节数，I/O写